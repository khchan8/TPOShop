<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TPO Wellness Store</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.reflowhq.com/v2/toolkit.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="theme-switcher.css">

    <!-- ReflowHQ Integration -->
    <script>
        window.reflowStore = {
            id: "1701742151"
        };
    </script>
    <script src="https://cdn.reflow.io/api.js"></script>
    <script src="https://cdn.reflowhq.com/v2/toolkit.min.js" data-reflow-project="1701742151" data-reflow-locale="https://khchan8.github.io/TPOShop/TH.json"></script>
    <script>
        window.addEventListener('reflow:ready', function() {
            console.log('Reflow Ready'); // Debug log
            if (!window.Reflow.customer.isAuthenticated()) {
                console.log('User not authenticated, redirecting...'); // Debug log
                window.location.href = 'auth.html';
            } else {
                console.log('User is authenticated'); // Debug log
            }
        });
    </script>

<style>
		.confetti {
			position: fixed;
			width: 15px;
			height: 15px;
			z-index: 9999; /* Increased z-index */
			animation: fall 6s linear infinite;
			opacity: 0.7;
			box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
			pointer-events: none; /* Ensure confetti doesn't interfere with clicks */
		}
		@keyframes fall {
			from {
				transform: translateY(-5vh) translateX(0) rotate(0deg);
				opacity: 1;
			}
			to {
				transform: translateY(105vh) translateX(20vw) rotate(720deg);
				opacity: 0;
			}
		}
		/* Ensure the confetti container is above everything */
		#confetti-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 9998;
		}
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: explode 2s ease-out infinite;
        }
        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(20);
                opacity: 0;
            }
        }
		body {
			font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			color: var(--text-color);
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			padding-top: 56px; /* Adjusted for single row sticky navbar */
		}
		.content {
			flex: 1 0 auto;
			padding: 1rem 0;
		}
		.sticky-top {
			position: fixed;
			top: 0;
			width: 100%;
			z-index: 1000;
		}
		@media (max-width: 991px) {
			.navbar-collapse {
				background-color: white;
				padding: 1rem;
				border-radius: 0.5rem;
				box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
			}
		}
</style>
</head>
<body>

    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="index.html">TPO Wellness Store</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#combinedNav" aria-controls="combinedNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="combinedNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="FAQ.html">FAQ</a></li>
                        <li class="nav-item"><a class="nav-link" href="UploadReceipt.html">Payment</a></li>
                        <li class="nav-item"><a class="nav-link" href="OrderStatus.html">Order Status</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="themeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Switch
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="themeDropdown">
                                <li><a class="dropdown-item theme-option" href="#" data-theme="">Default</a></li>
                                <li><a class="dropdown-item theme-option" href="#" data-theme="dark-mode">Dark</a></li>
                                <li><a class="dropdown-item theme-option" href="#" data-theme="happy-mode">Legal</a></li>
                                <li><a class="dropdown-item theme-option" href="#" data-theme="family-mode">Herbal Haven</a></li>
                                <li><a class="dropdown-item theme-option" href="#" data-theme="matrix-mode">Rain</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-primary" role="button" href="cart.html">
                                <i class="bi bi-cart"></i> See Cart
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="window.Reflow.customer.logout()">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="content">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <!-- Category List in Horizontal Bar Layout -->
                    <div data-reflow-type="category-list" data-reflow-layout="horizontal-bar" data-reflow-category-link="category.html?category={id}"></div>

                    <!-- Product List -->
                    <div data-reflow-type="product-list" data-reflow-layout="cards" data-reflow-order="date_desc" data-reflow-show="image, name, excerpt, price, pagination" data-reflow-product-link="product.html?product={id}"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer mt-auto">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item"><a href="about.html">About Us</a></li>
                        <li class="list-inline-item"><a href="https://facebook.com/tpowellness" aria-label="Facebook"><i class="bi bi-facebook"></i></a></li>
                        <li class="list-inline-item"><a href="https://instagram.com/tpowellness" aria-label="Instagram"><i class="bi bi-instagram"></i></a></li>
                        <li class="list-inline-item"><a href="https://twitter.com/tpowellness" aria-label="Twitter"><i class="bi bi-twitter"></i></a></li>
                        <li class="list-inline-item"><a href="https://line.me/tpowellness" aria-label="Line"><i class="bi bi-line"></i></a></li>
                    </ul>
                </div>
                <div class="col-md-4 text-md-end">
                    <p class="mb-0">Â© 2024 TPO Wellness Store. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

			document.body.insertAdjacentHTML('beforeend', '<div id="confetti-container"></div>');

		// Confetti Functions
		let confettiInterval;
		let activeConfetti = new Set();

		function startConfetti() {
			if (!confettiInterval) {
				confettiInterval = setInterval(createConfetti, 500); // Increased frequency for more confetti
			}
		}

		function stopConfetti() {
			if (confettiInterval) {
				clearInterval(confettiInterval);
				confettiInterval = null;
			}
			activeConfetti.forEach(confetti => {
				confetti.remove();
			});
			activeConfetti.clear();
		}

		function createConfetti() {
			const confetti = document.createElement('div');
			confetti.className = 'confetti';

			// Random positioning and size
			confetti.style.left = Math.random() * 100 + 'vw';
			confetti.style.width = (Math.random() * 10 + 5) + 'px';
			confetti.style.height = confetti.style.width;

			// Random rotation and fall speed
			confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
			confetti.style.animationDuration = (Math.random() * 3 + 5) + 's'; // Smooth and varied fall

			// Random color and shape
			confetti.style.backgroundColor = getRandomColor();
			confetti.style.borderRadius = Math.random() < 0.5 ? '50%' : '0'; // Circle or square

			document.body.appendChild(confetti);
			activeConfetti.add(confetti);

			confetti.addEventListener('animationend', () => {
				confetti.remove();
				activeConfetti.delete(confetti);
			});
		}

		function getRandomColor() {
			// Vibrant colors with more variety
			const colors = ['#FF00FF', '#00FFFF', '#FFFF00', '#FF5733', '#33FF57', '#3357FF', '#FF33A8', '#33FFA8'];
			return colors[Math.floor(Math.random() * colors.length)];
		}

        // Fireworks Functions
        let fireworksInterval;
        function startFireworks() {
            fireworksInterval = setInterval(createFirework, 1000);
        }

        function stopFireworks() {
            clearInterval(fireworksInterval);
            document.querySelectorAll('.firework').forEach(f => f.remove());
        }

        function createFirework() {
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = Math.random() * 100 + 'vw';
            firework.style.top = Math.random() * 100 + 'vh';
            firework.style.backgroundColor = getRandomColor();
            document.body.appendChild(firework);

            setTimeout(() => {
                firework.remove();
            }, 2000);
        }
        // Matrix Functions
        function createMatrixRain() {
            const matrixCanvas = document.createElement('canvas');
            matrixCanvas.id = 'matrixCanvas';
            matrixCanvas.style.position = 'fixed';
            matrixCanvas.style.top = 0;
            matrixCanvas.style.left = 0;
            matrixCanvas.style.width = '100vw';
            matrixCanvas.style.height = '100vh';
            matrixCanvas.style.pointerEvents = 'none';
            matrixCanvas.style.zIndex = -1;
            document.body.appendChild(matrixCanvas);

            const ctx = matrixCanvas.getContext('2d');
            matrixCanvas.width = window.innerWidth;
            matrixCanvas.height = window.innerHeight;

            const matrix = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%';
            const font_size = 10;
            const columns = matrixCanvas.width / font_size;
            const drops = [];

            for (let x = 0; x < columns; x++) drops[x] = 1;

            function drawMatrix() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);

                ctx.fillStyle = '#0F0';
                ctx.font = font_size + 'px arial';

                for (let i = 0; i < drops.length; i++) {
                    const text = matrix[Math.floor(Math.random() * matrix.length)];
                    ctx.fillText(text, i * font_size, drops[i] * font_size);

                    if (drops[i] * font_size > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0;

                    drops[i]++;
                }
            }

            const matrixInterval = setInterval(drawMatrix, 33);

            matrixCanvas.dataset.intervalId = matrixInterval;
        }

        function removeMatrixRain() {
            const matrixCanvas = document.getElementById('matrixCanvas');
            if (matrixCanvas) {
                clearInterval(parseInt(matrixCanvas.dataset.intervalId));
                matrixCanvas.remove();
            }
        }
		        // Update content based on the current theme
        function updateContent(theme) {
            const navbar = document.querySelector('.navbar-brand');
            switch(theme) {
                case 'dark-mode':
                    navbar.textContent = 'Black Market Cannabis Shop';
                    break;
                case 'happy-mode':
                    navbar.textContent = 'Legal THC Paradise';
                    break;
                case 'family-mode':
                    navbar.textContent = 'Herbal Haven';
                    break;
                case 'matrix-mode':
                    navbar.textContent = 'The Matrix Cannabis';
                    break;
                default:
                    navbar.textContent = 'TPO Wellness Store';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            // Add smooth scrolling to all links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();

                    const targetId = this.getAttribute('href');
                    if (targetId && targetId !== '#') {
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });

            // Add active class to current navigation item
            const currentLocation = location.href;
            const menuItems = document.querySelectorAll('nav a');
            const menuLength = menuItems.length;
            for (let i = 0; i < menuLength; i++) {
                if (menuItems[i].href === currentLocation) {
                    menuItems[i].classList.add('active');
                }
            }

			// Theme Switching Functionality
			const themeLinks = document.querySelectorAll('.theme-option');

			function setTheme(theme) {
				document.body.className = theme;
				localStorage.setItem('shopMode', theme);
				updateContent(theme);

				// Remove all effects
				removeMatrixRain();
				stopConfetti();
				stopFireworks();

				// Apply theme-specific effects
				if (theme === 'matrix-mode') {
					createMatrixRain();
				} else if (theme === 'happy-mode') {
					startConfetti();
				} else if (theme === 'family-mode') {
					startFireworks();
				}
			}

			themeLinks.forEach(link => {
				link.addEventListener('click', function(e) {
					e.preventDefault();
					const selectedTheme = this.dataset.theme;
					setTheme(selectedTheme);
				});
			});

			// Load saved theme from localStorage
			const savedTheme = localStorage.getItem('shopMode');
			if (savedTheme) {
				setTheme(savedTheme);
			}

            // Initialize Bootstrap Dropdown
            var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'))
            var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                return new bootstrap.Dropdown(dropdownToggleEl)
            });
        });

    </script>
</body>
</html>
